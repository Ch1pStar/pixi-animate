<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/plugins/springroll/FlashArtTask.js - PixiAnimate</title>
    <link rel="stylesheet" href="">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>
<body class="yui3-skin-sam">
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <h1 class="brand" style="padding: 10px 16px 10px; height: 20px; line-height: 20px; margin-left: 0;">
	    <img alt="PixiAnimate" src="../assets/css/logo.png" style="max-height: 65%;" title="PixiAnimate">
            PixiAnimate
        </h1>
	<div class="nav">
            <li class="divider-vertical"></li>
            <li>
                <p class="navbar-text">
                    API Docs for Version: <b>0.3.4</b>
                </p>
            </li>
        </div>
        <form class="navbar-form pull-right" style="line-height: 40px; height: 40px;">
            <input style="margin-top: 0;" type="text" class="search-query" placeholder="Search for classes/modules..." data-obj='["classes/PIXI.animate.ColorUtils", "classes/PIXI.animate.FlashArt", "classes/PIXI.animate.FlashArtTask", "classes/PIXI.animate.load", "classes/PIXI.animate.MovieClip", "classes/PIXI.animate.MovieClipInstance", "classes/PIXI.animate.ShapesCache", "classes/PIXI.animate.SpriteSheetTask", "classes/PIXI.animate.SymbolLoader", "classes/PIXI.animate.Timeline", "classes/PIXI.Container", "classes/PIXI.DisplayObject", "classes/PIXI.Graphics", "classes/PIXI.Sprite", "classes/PIXI.Text", "modules/PixiAnimate", "modules/SpringRoll Plugin"]'>
        </form>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="span3">
	    <div>
	        <h3>APIs</h3>
	        <div id="sidebar">
	            <ul id="main-nav" class="nav nav-tabs" style="margin-bottom:0;">
	                <li class="active"><a href="#classes" data-toggle="tab">Classes</a></li>
	                <li><a href="#modules" data-toggle="tab">Modules</a></li>
	            </ul>
	    
	            <div id="api-tabview-filter">
	                <input type="search" placeholder="Type to filter APIs">
	            </div>
	    
	            <div class="tab-content" style="border: 1px solid #DDD; border-top:0;">
	                <div class="tab-pane active" id="classes">
	                    <ul id="api-classes" class="nav nav-list">
	                            <li><a href="../classes/PIXI.animate.load.html">PIXI.animate.load</a></li>
	                            <li><a href="../classes/PIXI.animate.MovieClip.html">PIXI.animate.MovieClip</a></li>
	                            <li><a href="../classes/PIXI.animate.ShapesCache.html">PIXI.animate.ShapesCache</a></li>
	                            <li><a href="../classes/PIXI.animate.SymbolLoader.html">PIXI.animate.SymbolLoader</a></li>
	                            <li><a href="../classes/PIXI.animate.Timeline.html">PIXI.animate.Timeline</a></li>
	                            <li><a href="../classes/PIXI.Container.html">PIXI.Container</a></li>
	                            <li><a href="../classes/PIXI.DisplayObject.html">PIXI.DisplayObject</a></li>
	                            <li><a href="../classes/PIXI.Graphics.html">PIXI.Graphics</a></li>
	                            <li><a href="../classes/PIXI.Sprite.html">PIXI.Sprite</a></li>
	                            <li><a href="../classes/PIXI.Text.html">PIXI.Text</a></li>
	                    </ul>
	                </div>
	    
	                <div class="tab-pane" id="modules">
	                    <ul id="api-modules" class="nav nav-list">
	                            <li><a href="../modules/PixiAnimate.html">PixiAnimate</a></li>
	                            <li><a href="../modules/SpringRoll Plugin.html">SpringRoll Plugin</a></li>
	                    </ul>
	                </div>
	            </div>
	        </div>
	    </div>
        </div>
        <div class="span9">
                <form id="options-form" class="form-inline pull-right">
                    Show:
                    <label for="api-show-inherited" class="checkbox">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected" class="checkbox">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private" class="checkbox">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated" class="checkbox">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </form>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<div class="page-header">
    <h1>src/plugins/springroll/FlashArtTask.js <small>File</small></h1>
</div>

<div class="file">
    <pre class="prettyprint linenums">
/**
 * @module SpringRoll Plugin
 * @namespace PIXI.animate
 * @requires PixiAnimate
 */
(function()
{
	var Task = include(&#x27;springroll.Task&#x27;),
		FlashArt = include(&#x27;PIXI.animate.FlashArt&#x27;),
		TextureAtlas = include(&#x27;springroll.pixi.TextureAtlas&#x27;),
		Texture = include(&#x27;PIXI.Texture&#x27;);

	/**
	 * Loads a FlashArt, making it easier to load and unload PixiAnimate art.
	 * @class FlashArtTask
	 * @extends springroll.Task
	 * @constructor
	 * @private
	 * @param {Object} asset The data properties
	 * @param {String} asset.type Asset type must be &quot;pixi&quot;
	 * @param {String} asset.format Asset format must be &quot;PIXI.animate.FlashArt&quot;
	 * @param {String} asset.src The source
	 * @param {Array} asset.images An array of Image, TextureAtlas, or SpriteSheet assets to load
	 * @param {Boolean} [asset.cache=false] If we should cache the result
	 * @param {String} [asset.id] Id of asset
	 * @param {Function} [asset.complete] The event to call when done
	 * @param {Object} [asset.sizes=null] Define if certain sizes are not supported
	 */
	var FlashArtTask = function(asset)
	{
		Task.call(this, asset, asset.src);

		/**
		 * The path to the flash asset
		 * @property {String} src
		 */
		this.src = this.filter(asset.src);

		/**
		 * Any image, atlas, or SpriteSheet assets that should be loaded along with this piece
		 * of flash art.
		 * @property {Array} images
		 */
		this.images = asset.images;

		/**
		 * The name of the window object library items hang on
		 * @property {String} libName
		 */
		this.libName = &quot;lib&quot;;

		/**
		 * The name of the window object images hang on
		 * @property {String} imagesName
		 */
		this.imagesName = &quot;images&quot;;
	};

	// Reference to prototype
	var p = extend(FlashArtTask, Task);

	/**
	 * Test if we should run this task
	 * @method test
	 * @static
	 * @param {Object} asset The asset to check
	 * @return {Boolean} If the asset is compatible with this asset
	 */
	FlashArtTask.test = function(asset)
	{
		return asset.src &amp;&amp;
			asset.src.search(/\.js$/i) &gt; -1 &amp;&amp;
			asset.type == &quot;pixi&quot; &amp;&amp;
			asset.format == &quot;PIXI.animate.FlashArt&quot; &amp;&amp;
			asset.images &amp;&amp; Array.isArray(asset.images);
	};

	/**
	 * Start the task
	 * @method  start
	 * @param  {Function} callback Callback when finished
	 */
	p.start = function(callback)
	{
		var images = [];
		var atlas, assetCount = 0;
		var asset;
		for (var i = 0; i &lt; this.images.length; ++i)
		{
			//check for texture atlases from TexturePacker or similar things
			if (this.images[i].atlas)
			{
				asset = this.images[i];
				atlas = {
					atlas: this.filter(asset.atlas),
					id: &quot;asset_&quot; + (assetCount++),
					type: &quot;pixi&quot;
				};
				if (asset.image)
					atlas.image = this.filter(asset.image);
				else
				{
					atlas.alpha = this.filter(asset.alpha);
					atlas.color = this.filter(asset.color);
				}
				images.push(atlas);
			}
			//Check for EaselJS style SpriteSheets
			else if (this.images[i].format == &quot;PIXI.animate.SpriteSheet&quot;)
			{
				asset = this.images[i].clone();
				images.push(asset);
				if (!asset.type)
					asset.type = &quot;pixi&quot;;
				if (!asset.id)
					asset.id = &quot;asset_&quot; + (assetCount++);
			}
			//standard images
			else
			{
				//check for urls
				if (typeof this.images[i] == &quot;string&quot;)
					asset = {
						image: this.filter(this.images[i])
					};
				//and full tasks
				else
					asset = this.images[i].clone();
				//ensure an ID for these
				if (!asset.id)
				{
					var fallbackId = asset.src || asset.color;
					// Remove the file extension
					var extIndex = fallbackId.lastIndexOf(&#x27;.&#x27;);
					if (extIndex &gt; -1)
					{
						fallbackId = fallbackId.substr(0, extIndex);
					}
					// Check for the last folder slash then remove it
					var slashIndex = fallbackId.lastIndexOf(&#x27;/&#x27;);
					if (slashIndex &gt; -1)
					{
						fallbackId = fallbackId.substr(slashIndex + 1);
					}
					asset.id = fallbackId;
				}
				//also ensure that they are PIXI Texture assets
				asset.type = &quot;pixi&quot;;
				images.push(asset);
			}
		}

		var assets = {
			_flash: this.src
		};
		if (images.length)
			assets._images = {
				assets: images
			};

		// Load all the assets
		this.load(assets, function(results)
		{
			var art = new FlashArt(
				this.id,
				results._flash,
				this.libName
			);

			var images = results._images;
			if (images)
			{
				var image;
				var objectsToDestroy = [];
				var texturesToRemove = [];
				var globalImages = namespace(this.imagesName);

				for (var id in images)
				{
					var result = images[id];

					//save the item for cleanup
					objectsToDestroy.push(result);

					//look for individual images
					if (result instanceof Texture)
					{
						globalImages[id] = result;
						texturesToRemove.push(id);
					}
					else if (result instanceof TextureAtlas)
					{
						var frames = result.frames;
						for (var frame in frames)
						{
							globalImages[frame] = frames[frame];
							texturesToRemove.push(frame);
						}
					}
				}

				art._orig_destroy = art.destroy;
				art.destroy = function()
				{
					var i;
					for (i = objectsToDestroy.length - 1; i &gt;= 0; --i)
					{
						if (objectsToDestroy[i].destroy)
							objectsToDestroy[i].destroy();
						else
							objectsToDestroy[i].dispatchEvent(&quot;destroy&quot;);
					}
					for (i = texturesToRemove.length - 1; i &gt;= 0; --i)
					{
						delete globalImages[texturesToRemove[i]];
					}
					art._orig_destroy();
				};
			}
			callback(art);

		}.bind(this));
	};

	// Assign to namespace
	namespace(&#x27;PIXI.animate&#x27;).FlashArtTask = FlashArtTask;

}());
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/jquery/jquery-1.8.2.min.js"></script>
<script src="../assets/vendor/bootstrap/js/bootstrap.js"></script>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script src="../assets/js/yuidoc-bootstrap.js"></script>
<script>prettyPrint();</script>
</body>
</html>
